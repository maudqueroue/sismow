---
title: "Population Abundance Emulator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Population Abundance Emulator}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(sismow)
```

<!-- This vignette is generated by fusen: do not edit by hand -->

<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.
-->


## Simulate density maps

The `simulate_density`function allows to simulate different densities in a given area:         

- A **homogeneous** density with the same density througout the aera.    
- A **gradient** density with a density decreasing from a hotspot that could be placed on different direction: North, North-East, East, South-East, South, South-West, West, North-West and center). The amplitude and the wavelength of the hotspot created can be modified by the user.    
- A **random** density, created by adding a certain number of hotspots on the area. Each hotspot created have an amplitude and a wavelength randomly chosen between 1 and a maximum amplitude and a maximum wavelength that can be modified by the user.     

The output is a sf dataframe of the simulated density on the map. The dataframe contains two columns:    
- `density` : density simulated for each square of the grid    
- `geometry` : geometry of the grid 


### Examples

For these examples, `shape_courseulles`, a dataframe included in this package is used. With `simulate_density` some density maps are simulated:     
- (1) a **gradient** density map with a hotspot of density in the North     
- (2) a **random** density map with 10 random hotspots   


```{r examples-simulate_density, warning = FALSE, fig.height = 3, fig.width = 7}

library(ggplot2)
data("shape_courseulles")

# ------------------------------
# Example 1: Simulate a map with a gradient density from the North
#-------------------------------

map <- simulate_density(shape_obj = shape_courseulles,
                              density_type = "gradient",
                              gradient_direction = "N",
                              wavelength = 20000,
                              amplitude = 10)

# Plot
ggplot() +
  geom_sf(data = map, aes(fill = density)) +
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))


# ------------------------------
# Example 2: Simulate a map with a random density
# ------------------------------

map <- simulate_density(shape_obj = shape_courseulles,
                              density_type = "random",
                              wavelength = 10000,
                              amplitude = 15,
                              nb_hotspots = 10
                              
)

# Plot 
ggplot() +
  geom_sf(data = map, aes(fill = density)) +
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))

```

## Simulate individuals

The `simulate_ind` function allows to simulate an approximate number of individuals/groups with an inhomogenous Poisson point process according to the densities provided.

From a sf dataframe containing density map `map_obj`, an inohomogene Poisson point process is used to simulate the presence of `N` individuals/groups on the map. The probability of presence of an individual/group is dependent on the density given by the map. Groups are simulated using a Poisson distribution, with parameter `mean_group_size`.  

The output is the simulated individuals in a dataframe. The dataframe contains three columns:        
-`x` : longitude of the simulated individual/group.     
-`y` : latitude of the simulated individual/group.     
- `size` : the number of individuals simulated on the location.


### Examples

For these examples, we used `shape_courseulles`, a dataframe included in this package and the function `simulate_density` to simulate a density map. Then, with used `simulate_ind` to simulate individuals:          
- (1) simulation of **200 individuals** in the area.     
- (2) simulation of **100 groups** with a **mean group size of 5 individuals**.       

The function returns a dataframe, containing the different individuals simulated in line, the size of each group and their geographic coordinates in column. 


```{r examples-simulate_ind, warning = FALSE, fig.height = 3, fig.width = 7}

library(ggplot2)
data("shape_courseulles")

# First, create a map with a gradient density from the North
map <- simulate_density(shape_obj = shape_courseulles,
                              grid_size = 1000,
                              density_type = "gradient",
                              gradient_direction = "N",
                              wavelength = 20000,
                              amplitude = 15)

# ------------------------------
# Example 1. Simulate the presence of 200 individuals 
# ------------------------------

ind <- simulate_ind(map_obj = map, N = 200)

# Plot
ggplot() +
  geom_sf(data = map, aes(fill = density)) +
  geom_point(data = ind, aes(x = x, y = y)) +
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))


# ------------------------------
# Example 2. Simulate the presence of 100 groups with a mean group size of 5 individuals 
# ------------------------------

ind <- simulate_ind(map_obj = map, mean_group_size = 5, N = 100)

# Plot
ggplot() +
  geom_sf(data = map) +
  geom_point(data = ind, aes(x = x, y = y, color = size)) +
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))
  
```

