---
title: "Observation Data Emulator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Observation Data Emulator}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(sismow)
```

<!-- This vignette is generated by fusen: do not edit by hand -->

## Simulate Observations

`simulate_obs` allows to simulate datasets of observations according to:    
1. The individuals/groups simulated on the density map   
2. The transect design simulated   
3. A detection probability         

To determine the detection probability, the user can choose:    
- The form of the detection function : **uniform** or **half-normal**    
- The maximum distance of observation (**truncation**)    
- The probability of observation at distance 0 (**g_zero**)    
- The effective strip width (**esw**) for half-normal detection function    

The output is a dataframe containing all the individuals/groups simulated in line. The dataframe contains eigth columns:         
- `object_ID` : unique identification of individuals/groups     
- `size` : size of group (=1 for individuals).    
- `detected` : 0 for non detected or 1 for detected individuals/groups      
- `proba` : probability of detection of the individual/group (according to the distance to the nearest transect/segment)     
- `distance` : distance in m between individual/group and the nearest transect/segment.
- `seg_ID` : identification of the nearest segment/transect     
- `x` : longitude of the individual/group     
- `y` : latitude of the individual/ group     


### Examples

For this example, `shape_courseulles`, a dataframe included in this package is used. First, create a density map, then simulate individuals on the map, and then simulate a transect design. 

With `simulate_obs` observations of individuals/groups are simulated under different detection conditions:     
- (1) **Half normal** detection probability equal to **1** at 0 distance (g_zero) with a effective strip half width of **180m** (esw).     
- (2) **Uniform** detection probability equal to **1** below distance **200m** (truncation).    


```{r examples-simulate_obs, warning = FALSE, message = FALSE}

library(ggplot2)
data("shape_courseulles")

# First, create a density map
map <- simulate_density(shape_obj = shape_courseulles,
                        density_type = "gradient",
                        gradient_direction = "N",
                        wavelength = 20000,
                        amplitude = 15)

# Then simulate the presence of individuals 
ind <- simulate_ind(map_obj = map, N = 400)

# Then create transects
transects <- simulate_transects(shape_obj = map,
                                design = "systematic",
                                line_length = 400000,
                                design_angle = 2,
                                segmentize = TRUE,
                                seg_length = 2000)

# Finally, detection of individuals is simulated according to 
# simulated individuals and simulated transects:

# ------------------------------
# Example 1 : With half normal detection probability equal to 1 at 0 distance (g_zero)
# with a effective strip half width of 180m.
# ------------------------------

obs <- simulate_obs(ind_obj = ind,
                    transect_obj = transects,
                    key = "hn",
                    g_zero = 1,
                    esw = 180)

# Plot detection probability
ggplot(obs, aes(x=distance, y=proba)) +
  geom_point(color = "#EE6C4D") +
  xlim(0,500) 

# Plot on map
ggplot() +
  geom_sf(data = map, fill = "#CDDAFD", color = "#CDDAFD") +
  geom_sf(data = transects, color = "black") +
  geom_point(data=obs[obs$detected==0,], aes(x=x, y=y), shape=20, color="#051923") +
  geom_point(data=obs[obs$detected==1,], aes(x=x, y=y), shape=21, fill="#EE6C4D") +
  labs(caption = paste("Sightings = ", sum(obs$detected), sep = " ")) +
  theme(legend.position = "none",
        panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))


# ------------------------------
# Example 2 : With uniform detection probability equal to 1 below distance 200m.
# ------------------------------

obs <- simulate_obs(ind_obj = ind,
                    transect_obj = transects,
                    key = "unif",
                    g_zero = 1,
                    truncation = 200)

# Plot detection probability
ggplot(obs, aes(x=distance, y=proba)) +
  geom_point(color = "#EE6C4D") +
  xlim(0,500) 

# Plot on map
ggplot() +
  geom_sf(data = map, fill = "#CDDAFD", color = "#CDDAFD") +
  geom_sf(data = transects, color = "black") +
  geom_point(data=obs[obs$detected==0,], aes(x=x, y=y), shape=20, color="#051923") +
  geom_point(data=obs[obs$detected==1,], aes(x=x, y=y), shape=21, fill="#EE6C4D") +
  labs(caption = paste("Sightings = ", sum(obs$detected), sep = " ")) +
  theme(legend.position = "none",
        panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(colour = "#EDEDE9"))

```

