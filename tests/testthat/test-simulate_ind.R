# WARNING - Generated by {fusen} from /dev/flat_population_abundance_emulator.Rmd: do not edit by hand

library(testthat)
library(dplyr)

test_that("simulate_ind works", {
  expect_true(inherits(simulate_ind, "function")) 
})

test_that("test conformite simulate_ind", {
  
  data("shape_courseulles")
  
  set.seed(2022)
  
  # First, create a density map
  map <- simulate_density(shape_obj = shape_courseulles,
                            density_type = "gradient",
                            gradient_direction = "N",
                            wavelength = 20000,
                            amplitude = 500)
  
  test_1 <- simulate_ind(map_obj = map, N = 500) %>%
                 slice(1:5)
  
  test_2 <- dput(simulate_ind(map_obj = map, N = 500, mean_group_size = 3) %>%
                 slice(1:5))

exp_1 <- structure(list(x = c(420661.308070772, 442923.262113165, 411757.519017249, 
472449.639991486, 430079.183413966), y = c(6944991.45049146, 
6946420.8560698, 6943660.15443901, 6922780.12565343, 6946391.36611633
), size = c(1, 1, 1, 1, 1)), class = "data.frame", row.names = c(NA, 
-5L))

exp_2 <- structure(list(x = c(421472.201308366, 450248.456275517, 453207.960703445, 
432487.789246782, 453272.022996037), y = c(6951565.57024664, 
6949954.04797684, 6938318.81822701, 6950822.54269574, 6935332.45247858
), size = c(3, 4, 1, 4, 4)), class = "data.frame", row.names = c(NA, 
-5L))

  expect_equal(object = test_1,
               expected = exp_1)
  
  expect_equal(object = test_2,
               expected = exp_2)

  expect_is(test_1, "data.frame")
  expect_is(test_2, "data.frame")

})

test_that("test erreur simulate ind", {
  
  data(iris)
  
  expect_error(object = simulate_ind(map_obj = iris, N = 500))
  
  # First, create a density map
  map <- simulate_density(shape_obj = shape_courseulles,
                            density_type = "gradient",
                            gradient_direction = "N",
                            wavelength = 20000,
                            amplitude = 500)
  
  expect_error(object = simulate_ind(map_obj = map, N = "haha"))
  expect_error(object = simulate_ind(map_obj = map))

  
  map_test <- map %>%
    rename(nop = density)
  
  expect_error(object = simulate_ind(map_obj = map_test,N = 500))
  
  map_test <- map
  map_test$density[5] <- "nop"
  
  expect_error(object = simulate_ind(map_obj = map_test, N = 500))
    expect_error(object = simulate_ind(map_obj = map, N = 500, mean_group_size = "ahah"))

  expect_error(object = simulate_ind(map_obj = map,
                                     N = 500,
                                     crs = "nop"))
  
})

