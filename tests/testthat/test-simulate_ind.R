# WARNING - Generated by {fusen} from /dev/flat_population_abundance_emulator.Rmd: do not edit by hand

library(testthat)
library(dplyr)

test_that("simulate_ind works", {
  expect_true(inherits(simulate_ind, "function")) 
})

test_that("test conformite simulate_ind", {
  
  data("shape_courseulles")
  
  set.seed(2022)
  
  # First, create a density map
  map <- simulate_density(shape_obj = shape_courseulles,
                            density_type = "gradient",
                            gradient_direction = "N",
                            wavelength = 20000,
                            amplitude = 500)
  
  test_1 <- simulate_ind(map_obj = map, N = 500) %>%
                 slice(1:5)
  
  test_2 <- simulate_ind(map_obj = map, N = 500, mean_group_size = 3) %>%
                 slice(1:5)

exp_1 <- structure(list(x = c(420735.085058459, 442929.50649375, 411813.427786551, 
473010.809885187, 429456.966987101), y = c(6944722.05314103, 
6946677.08270922, 6943497.73469272, 6922335.09657975, 6946351.78889112
), size = c(1, 1, 1, 1, 1)), class = "data.frame", row.names = c(NA, 
-5L))

exp_2 <- structure(list(x = c(421397.803351678, 443154.634449643, 426811.285929322, 
449480.53130473, 420502.151042837), y = c(6942516.3758206, 6931475.44524157, 
6932685.00458406, 6947618.97039875, 6943523.65804838), size = c(3, 
2, 2, 1, 2)), class = "data.frame", row.names = c(NA, -5L))

  expect_equal(object = test_1,
               expected = exp_1)
  
  expect_equal(object = test_2,
               expected = exp_2)

  expect_is(test_1, "data.frame")
  expect_is(test_2, "data.frame")

})

test_that("test erreur simulate ind", {
  
  data(iris)
  
  expect_error(object = simulate_ind(map_obj = iris, N = 500))
  
  # First, create a density map
  map <- simulate_density(shape_obj = shape_courseulles,
                            density_type = "gradient",
                            gradient_direction = "N",
                            wavelength = 20000,
                            amplitude = 500)
  
  expect_error(object = simulate_ind(map_obj = map, N = "haha"))
  expect_error(object = simulate_ind(map_obj = map))

  
  map_test <- map %>%
    rename(nop = density)
  
  expect_error(object = simulate_ind(map_obj = map_test,N = 500))
  
  map_test <- map
  map_test$density[5] <- "nop"
  
  expect_error(object = simulate_ind(map_obj = map_test, N = 500))
    expect_error(object = simulate_ind(map_obj = map, N = 500, mean_group_size = "ahah"))

  expect_error(object = simulate_ind(map_obj = map,
                                     N = 500,
                                     crs = "nop"))
  
})

